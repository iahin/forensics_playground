{"data": ["index=test1 (source=eventlogs.json OR sourcetype=_json OR tag=authentication) User=* User!=\"\" action=success | lookup User_account_status.csv User | where _time > relative_time(terminationDate, \"+1d\") | lookup gdpr_system_category.csv host as dest OUTPUT category | search category=*", "source=eventlogs.json index=test1 4776 EventID=4776 | rename ComputerName as DomainControllerName | table _time DomainControllerName User| stats earliest(_time) as earliest latest(_time) as latest  by User, anonymized_DomainControllerName | where earliest > relative_time(now(), \"-1d@d\") ", "index=test1 (source=eventlogs.json OR sourcetype=_json OR tag=authentication) User!=\"\"  | stats count(eval(action=\"success\")) as successes count(eval(action=\"failure\")) as failures by src | where successes>0 AND failures>100", "index=test1 (source=eventlogs.json OR sourcetype=_json OR tag=authentication) User=* User!=\"\"  | stats count(eval(action=\"success\")) as successes count(eval(action=\"failure\")) as failures by src dest | where successes>0 AND failures>100  | lookup gdpr_system_category host as dest| search category=* ", "index=test1 (source=eventlogs.json OR sourcetype=_json OR tag=authentication) User=* User!=\"\"  | stats count(eval(action=\"success\")) as successes count(eval(action=\"failure\")) as failures by src dest  | where successes>0 AND failures>100  | lookup gdpr_system_category host as dest | search category=* ", "| ldapsearch domain=splunk.local search=\"(&(objectclass=User)(!(objectClass=computer))(department=*))\" attrs=\"sAMAccountName,department\"| rename sAMAccountName as User | table department User | eventstats values(User) as peergroup by department | eval peergroup=mvjoin(peergroup, \",\")| outputlookup myPeerGroup.csv", "index=test1 source=eventlogs.json EventID=4688 (svchost.exe New_Process_Name=*svchost.exe) OR (iexplore.exe New_Process_Name=*iexplore.exe) OR (cmd.exe New_Process_Name=*cmd.exe) OR (firefox.exe New_Process_Name=*firefox.exe) OR (explorer.exe New_Process_Name=*explorer.exe) | rex field=New_Process_Name \"^(?<filepath>.*?)(?<filename>[^\\\\\\/]*)$\" | stats earliest(_time) as earliest latest(_time) as latest  by filename, filepath | where earliest > relative_time(now(), \"-1d@d\") ", "index=test1 source=eventlogs.json EventID=4688 [| inputlookup tools.csv WHERE discovery_or_attack=attack | stats values(filename) as search | format] | transaction host maxpause=5m | where eventcount>=4| fields - _raw closed_txn field_match_sum linecount", "index=test1 source=eventlogs.json EventID=4688 [|inputlookup tools.csv | search discovery_or_attack=discovery | stats values(filename) as search | eval search=mvjoin(search, \" OR \")] | transaction host maxpause=5m | where mvcount(Image)>=6| fields - _raw closed_txn field_match_sum linecount", "index=test1 sourcetype=_json EventID=1 Image=*fsutil* CommandLine=*usn* CommandLine=*deletejournal* | table _time host Image CommandLine", "index=test1 sourcetype=_json EventID=1 Image=*wmic* CommandLine=*node* CommandLine=\"*process call create*\" | table _time host Image CommandLine", "index=test1 sourcetype=_json EventID=1 Image=*wevtutil* CommandLine=*cl* (CommandLine=*System* OR CommandLine=*Security* OR CommandLine=*Setup* OR CommandLine=*Application*) | table _time host Image CommandLine", "index=test1 source=eventlogs.json User=* EventID=* action=failure LogonType=* Failure Reason Logon Type Status=0xC000015B", "index=test1 (source=eventlogs.json EventID=4688 New_Process_Name!=*Windows\\\\System32* New_Process_Name!=*Windows\\\\SysWOW64*) OR (sourcetype=_json EventID=1 Image!=*Windows\\\\System32* Image!=*Windows\\\\SysWOW64*) | eval process=coalesce(Image, New_Process_Name)  | rex field=process .*\\\\\\(?<filename>\\S+)\\s?$ | lookup isWindowsSystemFile_lookup filename | search systemFile=true | table _time dest host User process", "index=test1 source=eventlogs.json EventID=4688 | rex field=Image \"(?<filename>[^\\\\\\/]*)$\" | eval day=strftime(_time, \"%d/%m/%Y\")  | eventstats dc(day) as days_of_baseline by host | where days_of_baseline>7 | fields - day | eventstats dc(Image) as NumPaths values(Image) as Paths by filename, host | where NumPaths>1| stats earliest(_time) as earliest latest(_time) as latest  by filename, Image | where earliest > relative_time(now(), \"-1d@d\") ", "index=test1 sourcetype=_json EventID=1 | rex field=Image \"[\\\\\\/](?<filename>[^\\\\\\/]*)$\" | eval filename=lower(filename)| stats dc(filename) as NumFilenames values(filename) as Filenames values(Image) as Images by sha1 | where NumFilenames>1", "index=test1 host=jump* source=eventlogs.json (4624 OR 4647 OR 4648 OR 551 OR 552 OR 540 OR 528 OR 4768 OR 4769 OR 4770 OR 4771 OR 4768 OR 4774 OR 4776 OR 4778 OR 4779 OR 672 OR 673 OR 674 OR 675 OR 678 OR 680 OR 682 OR 683) (EventID=4624 OR EventID=4647 OR EventID=4648 OR EventID=551 OR EventID=552 OR EventID=540 OR EventID=528 OR EventID=4768 OR EventID=4769 OR EventID=4770 OR EventID=4771 OR EventID=4768 OR EventID=4774 OR EventID=4776 OR EventID=4778 OR EventID=4779 OR EventID=672 OR EventID=673 OR EventID=674 OR EventID=675 OR EventID=678 OR EventID=680 OR EventID=682 OR EventID=683)| stats earliest(_time) as earliest latest(_time) as latest  by User, dest | where earliest > relative_time(now(), \"-1d@d\") ", "index=test1 source=eventlogs.json (4624 OR 4647 OR 4648 OR 551 OR 552 OR 540 OR 528 OR 4768 OR 4769 OR 4770 OR 4771 OR 4768 OR 4774 OR 4776 OR 4778 OR 4779 OR 672 OR 673 OR 674 OR 675 OR 678 OR 680 OR 682 OR 683) (EventID=4624 OR EventID=4647 OR EventID=4648 OR EventID=551 OR EventID=552 OR EventID=540 OR EventID=528 OR EventID=4768 OR EventID=4769 OR EventID=4770 OR EventID=4771 OR EventID=4768 OR EventID=4774 OR EventID=4776 OR EventID=4778 OR EventID=4779 OR EventID=672 OR EventID=673 OR EventID=674 OR EventID=675 OR EventID=678 OR EventID=680 OR EventID=682 OR EventID=683)| stats earliest(_time) as earliest latest(_time) as latest  by User, dest | where earliest > relative_time(now(), \"-1d@d\") ", "index=test1 source=eventlogs.json (4624 OR 4647 OR 4648 OR 551 OR 552 OR 540 OR 528 OR 4768 OR 4769 OR 4770 OR 4771 OR 4768 OR 4774 OR 4776 OR 4778 OR 4779 OR 672 OR 673 OR 674 OR 675 OR 678 OR 680 OR 682 OR 683) | bucket _time span=1d | stats dc(host) as count by User _time| stats count as num_data_samples max(eval(if(_time >= relative_time(maxtime, \"-1d@d\"), 'count',null))) as count avg(eval(if(_time<relative_time(maxtime,\"-1d@d\"),'count',null))) as avg stdev(eval(if(_time<relative_time(maxtime,\"-1d@d\"),'count',null))) as stdev by User | eval lowerBound=(avg-stdev*2), upperBound=(avg+stdev*2)| where 'count' > upperBound AND num_data_samples >=7", "index=test1 source=eventlogs.json 4648 EventID=4648 | search NOT Account_Name=*$ | eval Unprivileged_Account_Name=mvindex(Account_Name, 1) | bucket _time span=1d | stats count by _time Unprivileged_Account_Name| stats count as num_data_samples max(eval(if(_time >= relative_time(maxtime, \"-1d@d\"), 'count',null))) as count avg(eval(if(_time<relative_time(maxtime,\"-1d@d\"),'count',null))) as avg stdev(eval(if(_time<relative_time(maxtime,\"-1d@d\"),'count',null))) as stdev by User | eval lowerBound=(avg-stdev*2), upperBound=(avg+stdev*2)| where 'count' > upperBound AND num_data_samples >=7", "index=test1 sourcetype=_json EventID=1 | eval cmdlen=len(CommandLine) | eventstats stdev(cmdlen) as stdev,avg(cmdlen) as avg by host | stats max(cmdlen) as maxlen, values(stdev) as stdevperhost, values(avg) as avgperhost by host,CommandLine | where maxlen> ((10*stdevperhost) + avgperhost)", "index=test1 source=eventlogs.json EventID=4624 Authentication_Package=NTLM Type=Information Account_Name!=\"ANONYMOUS LOGON\" LogonType=3 Logon_Process=\"NtLmSsP\" NOT Security_ID!=\"NULL SID\" Key_Length=0| stats earliest(_time) as earliest latest(_time) as latest  by Account_Domain, EventID | where earliest > relative_time(now(), \"-1d@d\") ", "index=test1 source=eventlogs.json LogonType=2 OR LogonType=10 OR LogonType=11 Logon Type TaskCategory=Logon Audit Success svc User=svc_* | table _time User dest | stats earliest(_time) as earliest latest(_time) as latest  by User, LogonType | where earliest > relative_time(now(), \"-1d@d\") ", "index=test1 source=eventlogs.json EventID=4720 OR (EventID=4732 Administrators) | transaction Security_ID maxspan=180m connected=false| search EventID=4720 (EventID=4732 Administrators)  | table _time EventID Account_Name Target_Account_Name Message", "index=test1 source=eventlogs.json LogonType=* Logon Type TaskCategory=Logon Audit Success | table _time User LogonType  | stats earliest(_time) as earliest latest(_time) as latest  by User, LogonType | where earliest > relative_time(now(), \"-1d@d\") ", "index=test1 sourcetype=_json EventID=1 (cmd.exe Image=*\\cmd.exe) OR (regedit.exe Image=*\\regedit.exe)  |table  _time host Image ProcessId ParentImage ParentProcessId sha1| stats earliest(_time) as earliest latest(_time) as latest  by Image, ParentImage | where earliest > relative_time(now(), \"-1d@d\") ", "index=test1 source=eventlogs.json EventID=4648 | search NOT Account_Name=*$ | eval Privileged_Account_Name=mvindex(Account_Name,1) | table _time  host Privileged_Account_Name| stats earliest(_time) as earliest latest(_time) as latest  by Privileged_Account_Name, host | where earliest > relative_time(now(), \"-1d@d\") ", "index=test1 source=eventlogs.json EventID=4688 services.exe | search ParentImage=*\\\\services.exe |table _time User host EventID New_Process_Name ParentImage| stats earliest(_time) as earliest latest(_time) as latest  by host, Image | where earliest > relative_time(now(), \"-1d@d\") ", "index=test1 source=eventlogs.json EventID=4688 [|inputlookup tools.csv | search discovery_or_attack=suspicious | stats values(filename) as search | eval search=mvjoin(search, \" OR \")] | stats earliest(_time) as earliest latest(_time) as latest  by Image, User | where earliest > relative_time(now(), \"-1d@d\") ", "index=test1 sourcetype=_json EventID=1 ( (cmd.exe Image=*\\\\cmd.exe) OR (regedit.exe Image=*\\\\regedit.exe) OR (powershell.exe Image=*\\\\powershell.exe) ) (services.exe Image=*\\\\system32\\\\services.exe)| stats earliest(_time) as earliest latest(_time) as latest  by Image, host | where earliest > relative_time(now(), \"-1d@d\") ", "index=test1 tag=privileged| stats earliest(_time) as earliest latest(_time) as latest  by User, dest | where earliest > relative_time(now(), \"-1d@d\") ", "index=test1 source=eventlogs.json tag=privileged| lookup PrivilegedRiskScores User OUTPUT isAdminAccount | search isAdminAccount=0 ", "| ldapsearch search=\"(&(objectclass=User)(!(objectClass=computer)))\" attrs=\"sAMAccountName,pwdLastSet,lastLogonTimestamp,whenCreated,badPwdCount,logonCount\" | fields - _raw host _time | convert timeformat=\"%Y-%m-%dT%H:%M:%S.%6QZ\" mktime(pwdLastSet) mktime(lastLogonTimestamp) | convert timeformat=\"%Y%m%d%H%M%S.0Z\"  mktime(whenCreated) | where pwdLastSet < relative_time(now(), \"-120d\") AND lastLogonTimestamp > relative_time(now(), \"-30d\") | convert ctime(lastLogonTimestamp) ctime(whenCreated) ctime(pwdLastSet)", "index=test1 source=eventlogs.json EventID=4688 New_Process_Name=C:\\\\Users*| lookup ut_shannon_lookup word as New_Process_Name | where ut_shannon > 4.5 | stats  values(ut_shannon)  as \"Shannon Entropy Score\" by New_Process_Name,host | rename  New_Process_Name as Process,host as Endpoint | sort  -\"Shannon Entropy Score\" ", "index=test1 (source=eventlogs.json EventID=4688 ) OR (sourcetype=_json EventID=1)| eval Image=coalesce(Image, New_Process_Name) | rex field=Image \"(?<filename>[^\\\\\\\\/]*$)\" | stats values(host) as hosts dc(host) as num_hosts values(Image) as Images by filename | eval levenshtein_scores=null | eval comparisonterm=\"svchost.exe\"  | lookup ut_levenshtein_lookup word1 as filename, word2 as comparisonterm | eval levenshtein_scores=mvappend(levenshtein_scores, ut_levenshtein) | eval score{ut_levenshtein} = comparisonterm | eval comparisonterm=\"iexplore.exe\" | lookup ut_levenshtein_lookup word1 as filename, word2 as comparisonterm | eval levenshtein_scores=mvappend(levenshtein_scores, ut_levenshtein) | eval score{ut_levenshtein} = comparisonterm | eval comparisonterm=\"ipconfig.exe\" | lookup ut_levenshtein_lookup word1 as filename, word2 as comparisonterm | eval levenshtein_scores=mvappend(levenshtein_scores, ut_levenshtein) | eval score{ut_levenshtein} = comparisonterm | eval comparisonterm=\"explorer.exe\" | lookup ut_levenshtein_lookup word1 as filename, word2 as comparisonterm | eval levenshtein_scores=mvappend(levenshtein_scores, ut_levenshtein) | eval score{ut_levenshtein} = comparisonterm | eventstats max(num_hosts) as max_num_hosts | where isnull(mvfilter(levenshtein_scores=\"0\")) AND min(levenshtein_scores) <3 | eval lowest_levenshtein_score=min(levenshtein_scores) | eval suspect_files = null | foreach score* [eval temp = \"<<FIELD>>\" | rex field=temp \"(?<num>\\d*)$\" | eval suspect_files=if(num<3,mvappend('<<FIELD>>', suspect_files),suspect_files) | fields - temp \"<<FIELD>>\"] | eval percentage_of_hosts_affected = round(100*num_hosts/max_num_hosts,2)| table filename lowest_levenshtein_score suspect_files Images hosts num_hosts percentage_of_hosts_affected", "| ldapsearch search=\"(&(objectclass=group)(|(cn=*Admins*)(cn=*Administrators*)))\" attrs=\"cn,distinguishedName,groupType,member,memberOf\" | search groupType=SECURITY_ENABLED | stats count by member | eval member=\"(distinguishedName=\" . member . \")\" | eval length = len(member) | streamstats sum(length) as length | eval queryNum = round((length + 5000000) / 10000000, 0)| stats values(member) as search by queryNum| eval search=\"(|\" . mvjoin(search, \"\") . \")\" | map maxsearch=100 search=\"| ldapsearch search=\\\"$search$\\\" attrs=\\\"sAMAccountName,title,displayName,sAMAccountName,mail,department,company,description\\\"\" | table description title displayName sAMAccountName mail department company | outputlookup Users_who_are_members_of_admin_groups.csv", "index=test1 sourcetype=_json EventID=2 OR EventID=11 | rex field=TargetFilename \"^\\S+(?<extension>\\.\\S+)$\" | lookup ransomware_extensions_lookup Extensions AS extension | search Name!=false  | stats values(TargetFilename) AS \"Files Written\" by _time, host, Image, Name, extension", "index=test1 sourcetype=_json EventID=2 EventID=11 [ | inputlookup ransomware_notes_lookup | rename ransomware_notes as TargetFilename | eval TargetFilename=\"*\" . TargetFilename | table TargetFilename]| bucket _time span=1d | stats values(TargetFilename) as filesWritten by _time host Image", "index=test1 source=eventlogs.json EventID=4688 wsmprovhost svchost ParentImage=*\\\\svchost.exe Image=*\\\\wsmprovhost.exe | table _time User host EventID New_Process_Name| stats earliest(_time) as earliest latest(_time) as latest  by User, dest | where earliest > relative_time(now(), \"-1d@d\") ", "index=test1 source=eventlogs.json   EventID=4726 OR EventID=4720 | eval Account_Name=mvindex(Account_Name,1) | transaction Account_Name maxspan=180m startswith=\"EventID=4726\" endswith=\"EventID=4720\" connected=false| table _time EventID Account_Name Message", "index=test1 source=eventlogs.json LogonType=2 OR LogonType=10 OR LogonType=11 Logon Type TaskCategory=Logon Audit Success | bucket _time span=1d | stats dc(dest) as count by _time User| stats count as num_data_samples max(eval(if(_time >= relative_time(maxtime, \"-1d@d\"), 'count',null))) as count avg(eval(if(_time<relative_time(maxtime,\"-1d@d\"),'count',null))) as avg stdev(eval(if(_time<relative_time(maxtime,\"-1d@d\"),'count',null))) as stdev by User | eval lowerBound=(avg-stdev*2), upperBound=(avg+stdev*2)| where 'count' > upperBound AND num_data_samples >=7", "index=test1 source=eventlogs.json LogonType=2 OR LogonType=10 OR LogonType=11 Logon Type TaskCategory=Logon Audit Success | bucket _time span=1d | stats dc(User) as count by _time dest| stats count as num_data_samples max(eval(if(_time >= relative_time(maxtime, \"-1d@d\"), 'count',null))) as count avg(eval(if(_time<relative_time(maxtime,\"-1d@d\"),'count',null))) as avg stdev(eval(if(_time<relative_time(maxtime,\"-1d@d\"),'count',null))) as stdev by dest | eval lowerBound=(avg-stdev*2), upperBound=(avg+stdev*2)| where 'count' > upperBound AND num_data_samples >=7", "index=test1 source=eventlogs.json action=success | stats count min(_time) as earliest max(_time) as latest by User | multireport     [| stats values(*) as * by User     | lookup account_status_tracker User OUTPUT count as prior_count earliest as prior_earliest latest as prior_latest     | where prior_latest < relative_time(now(), \"-90d\")     | eval explanation=\"The last login from this User was \" . (round( (earliest-prior_latest) / 3600/24, 2) ) . \" days ago.\"     | convert ctime(earliest) ctime(latest) ctime(prior_earliest) ctime(prior_latest) ]     [| inputlookup append=t account_status_tracker     | stats min(earliest) as earliest max(latest) as latest sum(count) as count by User     | outputlookup account_status_tracker     | where this_only_exists_to_update_the_lookup='so we will make sure there are no results'] ", "index=test1 (source=eventlogs.json OR sourcetype=_json OR tag=authentication) User=* User!=\"\" action=success | lookup User_account_status.csv User | where _time > relative_time(terminationDate, \"+1d\")", "index=test1 source=eventlogs.json User=* dest=* action=success | bucket _time span=1d | stats count by User, dest | lookup gdpr_system_category.csv host as dest OUTPUT category as dest_category | search dest_category=* | lookup gdpr_User_category User OUTPUT category as User_category| makemv delim=\"|\" dest_category | makemv delim=\"|\" User_category | where isnull(User_category) OR User_category != dest_category", "index=test1 source=eventlogs.json tag=authentication action=success LogonType=2 OR LogonType=10 OR LogonType=11 Logon Type NOT (Account_Domain=\"NT Authority\" OR Account_Domain=\"MYDOMAIN\" OR Account_Domain=\"SUBSIDIARY*\" OR Account_Domain=\"YourDomainsHere\" OR Account_Name=\"*$\")| eval  Account_Domain=mvfilter(Account_Domain!=\"-\")| table _time User Account_Domain, Authentication_Package, EventID, Key_Length, Logon_Process, LogonType, Security_ID, Type", "index=test1 (source=eventlogs.json AND (EventID=1102 OR EventID=1100)) OR ((source=eventlogs.json AND EventID=104) | stats count by _time EventID sourcetype host"]}